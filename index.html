<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台北西門町接髮專家Hange韓哥預約系統</title>
  <style>
    /* 保持與原始版本相同的樣式 */
  </style>
</head>
<body>
  <div class="container">
    <form id="bookingForm">
      <label for="name">1.姓名：</label>
      <input type="text" id="name" placeholder="名字" required>

      <label for="phone">2.電話：</label>
      <input type="tel" id="phone" maxlength="10" pattern="09[0-9]{8}" placeholder="09XXXXXXXX" value="09" required>

      <label for="date">3.預約日期：</label>
      <input type="date" id="date" placeholder="請選擇預約日期" required>

      <label for="time">4.預約時段：</label>
      <select id="time" required>
        <option value="" disabled selected>請選擇預約時段</option>
        <option value="13:00">13:00</option>
        <option value="14:00">14:00</option>
        <option value="15:00">15:00</option>
        <option value="16:00">16:00</option>
        <option value="17:00">17:00</option>
      </select>

      <label>5.預約項目：</label>
      <div class="multi-select" id="serviceOptions">
        <button type="button" data-value="接髮">接髮</button>
        <button type="button" data-value="染髮">染髮</button>
        <button type="button" data-value="燙髮">燙髮</button>
        <button type="button" data-value="剪髮">剪髮</button>
        <button type="button" data-value="洗髮">洗髮</button>
        <button type="button" data-value="頭髮護理">頭髮護理</button>
        <button type="button" data-value="頭皮護理">頭皮護理</button>
      </div>
      <span class="note">* 可複選多個項目</span>

      <button type="submit">送出預約</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      const customHolidays = ["12/28", "12/29", "12/30", "09/09", "10/10", "01/01", "02/28", "05/01", "06/15"];

      document.getElementById('date').setAttribute('min', todayStr);
      document.getElementById('date').addEventListener('change', function () {
        const selectedDate = new Date(this.value);
        const formattedDate = `${(selectedDate.getMonth() + 1).toString().padStart(2, '0')}/${selectedDate.getDate().toString().padStart(2, '0')}`;
        if (this.value === todayStr || selectedDate.getDay() === 1 || customHolidays.includes(formattedDate)) {
          alert(`${formattedDate} 無法預約，請選擇其他日期！`);
          this.value = '';
        }
      });

      const serviceOptions = document.querySelectorAll('#serviceOptions button');
      const selectedServices = new Set();
      serviceOptions.forEach(option => {
        option.addEventListener('click', function () {
          const value = this.getAttribute('data-value');
          if (selectedServices.has(value)) {
            selectedServices.delete(value);
            this.classList.remove('selected');
          } else {
            selectedServices.add(value);
            this.classList.add('selected');
          }
        });
      });

      document.getElementById('bookingForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const services = Array.from(selectedServices).join(', ');

        if (!services) {
          alert('請至少選擇一個預約項目！');
          return;
        }

        const address = "台北西門町";
        const icsContent = `
BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
BEGIN:VEVENT
SUMMARY:預約 - ${services}
DESCRIPTION:姓名: ${name}\\n電話: ${phone}
LOCATION:${address}
DTSTART:${date.replace(/-/g, '')}T${time.replace(':', '')}00
DTEND:${date.replace(/-/g, '')}T${time.replace(':', '')}00
END:VEVENT
END:VCALENDAR`;

        const blob = new Blob([icsContent], { type: "text/calendar" });
        const url = URL.createObjectURL(blob);

        document.body.innerHTML = `
          <p>預約已送出！</p>
          <button id="addGoogleCalendar">新增到 Google 行事曆</button>
          <button id="addDeviceCalendar">新增到行動裝置行事曆</button>
        `;

        document.getElementById('addGoogleCalendar').addEventListener('click', function () {
          const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent('預約 - ' + services)}&dates=${date.replace(/-/g, '')}T${time.replace(':', '')}00/${date.replace(/-/g, '')}T${time.replace(':', '')}00&details=${encodeURIComponent('姓名: ' + name + ', 電話: ' + phone)}&location=${encodeURIComponent(address)}`;
          window.open(googleCalendarUrl, '_blank');
        });

        document.getElementById('addDeviceCalendar').addEventListener('click', function () {
          const a = document.createElement('a');
          a.href = url;
          a.download = `${date}_${time}_預約.ics`;
          a.click();
        });
      });
    });
  </script>
</body>
</html>